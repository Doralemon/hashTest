define(["jquery","text!tpls/accoutManagementSecretKey.html","artTemplate","common/amdApi"],function(t,e,s,a){return function(n){a.ajax({url:"customers/"+n+"/licenses",type:"get",json:""},function(r){var o=s.render(e,r.result),l=t(o);t(".kandao-contentBody").html(l),t(".kandao-secretKey").on("click",".keyState",function(){var e=t(this).parents("tr").attr("state");e=parseInt(e);var s=t(this).parents("tr").attr("keyId");s=parseInt(s);var r=t(this).parent().siblings(".host").text(),o=t(this).parent().siblings(".key").text(),l={id:s,host:r,key:o,state:e};a.ajax({url:"customers/"+n+"/licenses/"+s,type:"post",json:JSON.stringify(l)},function(e){a.ajax({url:"customers/"+n+"/licenses",type:"get",json:""},function(e){for(var s='<div class="workKey"><h4>有效密钥</h4><table class="table table-striped table-hover"><thead><tr><th>密钥</th><th>主机</th><th>激活时间</th><th>操作</th></tr></thead><tbody>',a=0;a<e.result.licenses.length;a++){var n=e.result.licenses[a];0==n.state&&(s+='<tr keyId="'+n.id+'" state="'+n.state+'"><td class="key">'+n.key+'</td><td class="host">'+n.host+"</td><td>"+n.active_time+'</td><td><button type="button" class="btn keyState">冻结</button></td></tr>')}s+='</tbody></table></div><div class="noWorkKey"><h4>无效密钥</h4><table class="table table-striped table-hover"><thead><tr><th>密钥</th><th>主机</th><th>激活时间</th><th>操作</th></tr></thead><tbody>';for(var a=0;a<e.result.licenses.length;a++){var n=e.result.licenses[a];1==n.state&&(s+='<tr keyId="'+n.id+'" state="'+n.state+'"><td class="key">'+n.key+'</td><td class="host">'+n.host+"</td><td>"+n.active_time+'</td><td><button type="button" class="btn keyState">激活</button></td></tr>')}s+="</tbody></table></div>",t(".kandao-secretKey .keyContent").html(s)})})}),t(".kandao-secretKey").on("click",".btn-goback",function(){t(".accoutManagement").trigger("click")})})}});