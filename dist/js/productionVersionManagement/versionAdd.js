define(["jquery","text!tpls/productionVersionAdd.html","artTemplate","common/amdApi","productionVersionManagement/getData","productionVersionManagement/toggleLanguage","upload"],function(e,i,n,a,t,o){return function(n,r){e("#addVersionSon").remove();var d,l={};switch(r){case"android":case"android TV":d="apk";break;case"tablet":d="7z";break;case"camera":d="yak"}$productionVersionAdd=e(i).on("submit","form",function(i){i.preventDefault(),e(".kandao-versionManagement");var o=e('#addVersionSon input[name="version_name"]').val(),s=e('#addVersionSon input[name="version_code"]').val();s=parseInt(s);var u=/^[0-9]*$/;if(!e.trim(o)||!e.trim(s))return void alert("请输入版本名称/版本代号等信息！");if(!u.test(s))return void alert("版本代号必须为数字！");var f=e("#addVersionSon textarea.textCh").val(),p=e("#addVersionSon textarea.textEn").val();l.version_name=o,l.version_code=s,l.description=f,l.description_en=p;var m=l.file_name;return!l.file_name||e("#uploadifive-sourceFile-queue .fileinfo").text().indexOf("Error")>-1?void alert("请先上传程序包！"):(l.extension_name=m.substring(m.lastIndexOf(".")+1,m.length),d!==l.extension_name?void alert(r+"平台只支持后缀为."+d+"的文件"):void a.ajax({url:"softwares/"+n+"/versions/add",type:"post",json:JSON.stringify(l)},function(e){var i={limit:10};a.ajax({url:"softwares/"+n+"/versions",type:"get",json:JSON.stringify(i)},function(e){t.getInfoData(e),$productionVersionAdd.modal("hide")})}))}).appendTo("body").modal(),e(function(){e("#versionUpload").uploadifive({auto:!0,method:"post",uploadScript:a.getFileUrl()+"upload_action/",fileObjName:"upload",buttonText:"选择文件",fileType:!1,uploadLimit:1,queueSizeLimit:1,onUploadComplete:function(e,i){var i=JSON.parse(i);l.file_name=i.file_name,l.file_url=i.file_url,l.file_hash=i.file_hash,l.file_type=i.file_type,l.file_size=i.file_size},onCancel:function(i){e("#uploadifive-versionUpload input").eq(2).val(""),e("#frontSide").val(""),$data=e(this).data("uploadifive"),settings=$data.settings,settings.uploadLimit++},onFallback:function(){alert("该浏览器无法使用!")}})}),o($productionVersionAdd),e("#addVersionSon").find(".fileType").text("(文件类型仅支持."+d+")")}});