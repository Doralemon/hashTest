define(["jquery","text!tpls/websiteManagement/reportManagementEdit.html","artTemplate","common/amdApi","reportManagement/getData","../common/getPage"],function(e,t,a,n,i,o){return function(r,l,s,p){e("#reportEdit").remove();var u,d=o(e(".kandao-report"),10,!0);d.json.q=s,d.json.language=p,n.ajax({url:"official/media_report/"+r+"/info",type:"get"},function(o){var s=a.render(t,o.result),p=e(s).on("change",".language select",function(){u=e(this).val(),"ZH-CN"==u?(e("#reportEditFromCn").show(),e("#reportEditFromEn").hide()):(e("#reportEditFromCn").hide(),e("#reportEditFromEn").show())}).on("click",".btnSave",function(t){function a(t,a){var s=e("#reportEdit "+t+' input[name = "title"]').val(),u=e("#reportEdit "+t+' input[name = "source"]').val(),g=e("#reportEdit "+t+' input[name = "source_url"]').val(),c=e("#reportEdit "+t+' textarea[name = "description"]').val(),m={title:s,source:u,source_url:g,description:c,language:o.result.language};return e.trim(s)&&e.trim(u)&&e.trim(g)?e("#addMedia .thumbnail img").length>0&&-1==e("#addMedia #picID").val().indexOf(".jpg")?void alert("缩略图请使用后缀为.jpg的图片！"):void n.ajax({url:"official/media_report/"+r+"/change",type:"post",json:JSON.stringify(m)},function(){if(p.find(".fileinput-exists img").length>0){l.flag=!1;var t=new FormData(p.find(a)[0]);e.ajax({url:n.getFileUrl()+"upload_action/",type:"post",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){e.msg?console.log("upload success"):console.log(e.msg),l.flag=!0;var t={file_hash:e.file_hash,file_url:e.file_url,file_name:e.file_name,file_size:e.file_size,file_type:e.file_type,type:"report",pk:r};n.ajax({url:"medias/upload/thumbnail",type:"post",json:JSON.stringify(t)},function(e){})},error:function(e){l.flag=!0,console.log(e.msg)}})}l.flag=!0,n.ajax({url:"official/media_report/list",type:"get",json:d.json},function(t){i.getListData(t),setTimeout(function(){p.modal("hide"),e(".modal-backdrop").css("display","none")},300)})}):void alert("请输入新闻标题(Name)/新闻来源(News sources)/链接(URL)信息后提交！")}t.preventDefault(),"ZH-CN"==o.result.language?a("#reportEditFromCn","#reportEditImgCn"):a("#reportEditFromEn","#reportEditImgEn")}).appendTo("body").modal();e('#reportEdit select[name="language"] option').each(function(t,a){e(a).val()==o.result.language&&(e(this).prop("selected",!0),p.find(".language select").trigger("change"))})})}});