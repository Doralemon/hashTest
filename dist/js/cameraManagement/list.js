define(["jquery","text!tpls/cameraManagementList.html","artTemplate","cameraManagement/batchAll","cameraManagement/edit","cameraManagement/search","cameraManagement/delete","cameraManagement/deleteAll","common/amdApi","common/checked","common/getPage","bootstrap","page"],function(t,e,a,n,o,c,r,l,i,d,s){return function(h){function m(s){var m=Math.ceil(s.result.count/10);s.result.index=m;var b=a.render(e,s.result),p=t(b).on("click",".batchAll",function(){h.flag1=!1,n(s)}).on("click",".btn-edit",function(){var e=t(this).parents("tr").attr("id");o(e,s)}).on("click",".btn-delete",function(){h.flag2=!1;var e=t(this).parents("tr").attr("id");r(e)}).on("click",".camraserach",function(){c()}).on("click",".kandao-reset",function(){t("form")[0].reset(),t(".cameraManagement").trigger("click")}).on("keydown",'input[name="q"]',function(t){13==t.keyCode&&(t.preventDefault(),p.find(".camraserach").trigger("click"))});h.flag1=!0,h.flag2=!0,t(".kandao-contentBody").html(p),t(".breadcrumb li").eq(0).on("click",function(){t(".home").trigger("click")});var f=t(".camera .allCheckbox"),k=t(".camera .sonCheckbox");d.checkbox(f,k),t(".camera").on("click",".deleteAll",function(){var e=t(".camera .searchContent :checkbox[name=sonCheckbox]:checked"),a=[];if(0==e.size())return void alert("请至少选择一条信息进行删除操作！");for(var n=0;n<e.length;n++){if("烧录中"==t(e[n]).parents("tr").children().eq(3).text())return void alert("您选择的sn有烧录中，无法删除！");a.push(parseInt(t(e[n]).parents("tr").attr("id")))}l(a)});var v;v=m<6?m:6,1==m?t(".pagination").hide():t(".pagination").show(),function(e,a,n){p.find(".pagination").jBootstrapPage({pageSize:e,total:n,pageNow:g.page,maxPageButton:a,onPageClicked:function(e,a){g.page=a+1,i.ajax({url:"productions/cameras",type:"get",json:g},function(e){for(var a='<thead><tr><th><form action=""><div class="checkbox"><label><input type="checkbox" class="allCheckbox"></label></div></form></th><th>S/N</th><th>PIN</th><th>状态</th><th>关联邮箱</th><th>操作</th></tr></thead><tbody>',n="",o=0;o<e.result.data.length;o++){var c=e.result.data[o];1==c.state?n="未烧录":2==c.state?n="烧录中":3==c.state?n="已烧录":4==c.state&&(n="已失效"),a+='<tr id="'+c.id+'"><td><form action=""><div class="checkbox"><label><input type="checkbox" class="sonCheckbox" name="sonCheckbox"></label></div></form></td><td>'+c.sn+"</td><td>"+c.pin+"</td><td>"+n+"</td><td>"+c.email+'</td><td id="'+c.id+'"><button type="button" class="btn btn-edit btn-sm">编辑</button><button type="button" class="btn btn-delete btn-sm">删除</button></td></tr>'}a+="</tbody>",t(".camera table").html(a);var r=t(".camera .allCheckbox"),l=t(".camera .sonCheckbox");d.checkbox(r,l);for(var i=t(".camera .searchContent").find("table tr"),o=0;o<i.length;o++)"烧录中"==t(i[o]).children("td").eq(3).html()&&(t(".btn").removeClass("hover"),t(i[o]).find(".btn-delete").addClass("disabledCli disabled"))})}})}(10,v,s.result.count),u>6&&(t(".pagination .goTo input").val(g.page),t(".go").click(),t(".pagination .goTo input").val(""));for(var x=t(".camera .searchContent").find("table tr"),C=0;C<x.length;C++)"烧录中"==t(x[C]).children("td").eq(3).html()&&(t(".btn").removeClass("hover"),t(x[C]).find(".btn-delete").addClass("disabledCli disabled"));f=t(".camera .allCheckbox"),k=t(".camera .sonCheckbox"),d.checkbox(f,k)}var b=s(t(".camera"),10,h.flag1),g=b.json,u=b.json.page;t(".camera table tbody tr").length<=1&&!h.flag2&&(b.json.page=b.json.page-1||1),i.ajax({url:"productions/cameras",type:"get",json:g},function(t){if(!t.result.data.length)return b.json.page=b.json.page-1||1,void i.ajax({url:"productions/cameras",type:"get",json:g},function(t){m(t)});m(t)})}});