define(["jquery","text!tpls/systemBackend/systemUserEdit.html","artTemplate","common/amdApi","systemUserManagement/getData","bootstrap"],function(e,t,r,n,a){return function(a){e("#systemUserEdit").remove(),a=parseInt(a);var s=[];n.ajax({url:"backend/users/"+a,type:"get"},function(i){i.result.has_roles.forEach(function(e,t){s.push(e.id)});var o=r.render(t,i.result),l=e(o).on("click",".addRoles",function(t){t.preventDefault(),roleId=e("#systemUserEdit .roleManament select option:selected").attr("name"),roleId=parseInt(roleId);var r=e("#systemUserEdit .roleManament select").val(),n=!0;if(s.forEach(function(e,t){return e==roleId&&(alert("此角色您已选择！"),n=!1),!1}),n){var a='<div class="roleBox text-center" roleId="'+roleId+'">'+r+'<span class="glyphicon glyphicon-remove-circle"></span></div>';l.find(".selectedRoles").append(a),s.push(roleId)}}).on("click",".glyphicon",function(){var t=e(this).parent().attr("roleId");t=parseInt(t),e(this).parent().hide(),s.forEach(function(e,r){return e==t&&s.splice(r,1),!1})}).on("click",".userAdd",function(t){t.preventDefault();var r=e('#systemUserEdit input[name="name"]').val(),i=e('#systemUserEdit input[name="email"]').val(),o=e('#systemUserEdit input[name="phone"]').val();if(!/^[0-9]*$/.test(o))return void alert("手机号必须为纯数字！");if(!(e.trim(r)&&e.trim(i)&&e.trim(o)&&s))return alert("请输入所有信息再提交！"),!1;var d={id:a,name:r,email:i,phone:o,has_roles:s};n.ajax({url:"backend/users/"+a+"/change",type:"post",json:JSON.stringify(d)},function(t){l.modal("hide"),e(".systemUserManagement").trigger("click")})}).appendTo("body").modal()})}});