define(["jquery","text!tpls/mediaManagement/mediaLibraryInfo.html","artTemplate","common/amdApi","mediaManagement/getCloumnId","mediaManagement/getInfoData","mediaManagement/deleteLink","mediaManagement/deleteMedia","mediaManagement/getCloumnId","mediaManagement/getTagName","mediaManagement/saveInfo","mediaManagement/transCoding","mediaManagement/uploadFileRms","common/getPage","bootstrap","page"],function(e,a,n,i,t,o,r,l,d,m,c,f,s,u){return function(d,g,p,h,y){var b=u(e(".kandao-mediaLibraryInfo"));1==e(".kandao-mediaLibraryInfo table tbody tr").length&&(b.json.page=b.json.page-1||1),i.ajax({url:"medias/"+g+"/"+d+"/links",type:"get",json:b.json},function(u){i.ajax({url:"medias/"+g+"/"+d,type:"get"},function(y){var k=[],v=[],I=[],L=[];y.result.resTags=p.result;var M=y.result.columns,j=y.result.tags;M.forEach(function(e,a){k.push(e[1]+""),v.push(e[1]+"")}),j.forEach(function(e,a){I.push(e[0]),L.push(e[0])});var x=n.render(a,y.result);if($mediaLibraryInfo=e(x).on("click",".mediaList,.goBack",function(){e(".mediaLibrary").click()}).on("click",".infoDelete",function(){l(d,g)}).on("click",".infoSave",function(){c(g,d,k,v,I,L)}).on("click",".cloumnAdd",function(){var a=e(this).prev("#columnSel").val(),n=e("#columnSel option:selected").text();t(a,n,$mediaLibraryInfo,".bigCloumnBox",v)}).on("click",".tagAdd",function(){var a=e(this).prev().val();m(a,$mediaLibraryInfo,".bigTagBox",L)}).on("click",".bigCloumnBox .glyphicon-remove-circle",function(){e(this).parent().remove();var a=e(this).parent().attr("id");v.forEach(function(e,n){return e==a&&v.splice(n,1),!1})}).on("click",".bigTagBox  .glyphicon-remove-circle",function(){e(this).parent().remove();var a=e(this).parent().text();L.forEach(function(n,i){return e.trim(n)==e.trim(a)&&L.splice(i,1),!1})}).on("click",".transCode",function(){f(d,g)}).on("click",".linkDelete",function(){var a=e(this).parents("tr").attr("id");r(d,a,g)}),u.result.data.length<1?$mediaLibraryInfo.find(".transCode").prop("disabled",!0):$mediaLibraryInfo.find(".transCode").prop("disabled",!1),"live"!==g&&$mediaLibraryInfo.find(".mediaFluid").hide(),e(".kandao-contentBody").html($mediaLibraryInfo),s(e("#kandaoMediaLibraryInfo"),e("#kandaoMediaLibraryInfo #mediaInfoImg"),h,function(e){var a={file_hash:e.file_hash,file_url:e.file_url,type:g,pk:d,file_name:e.file_name,file_size:e.file_size,file_type:e.file_type};i.ajax({url:"medias/upload/thumbnail",type:"post",json:JSON.stringify(a)},function(e){alert("提交成功!")})}),!u.result.data.length)return void e(".kandao-mediaLibraryInfo").find(".linkContainer").html("暂时还没有数据哦~~");o.myAjax(b.json,u,g,d)})})}});