define(["jquery","text!tpls/mediaManagement/mediaLibrary.html","artTemplate","common/amdApi","mediaManagement/add","mediaManagement/cloumnManagement","mediaManagement/transCoding","mediaManagement/mediaInfo","mediaManagement/getData","mediaManagement/mediaSeach","mediaManagement/allSelected","mediaManagement/cloumnListAdd","mediaManagement/cloumnListremove","mediaManagement/clearAll","common/getPage","bootstrap","page"],function(e,n,a,t,i,o,c,l,m,d,r,s,u,g,f){return function(p,k){function h(t,f){f.result.tags=t.result;var h,v,j=a.render(n,f.result),x=e(j).on("click",".firstColumn .sBox",function(){e(".firstColumn .sBox").removeClass("active"),e(this).addClass("active"),h=e(this).attr("id")}).on("click",".secondColumn .sBox",function(){e(".secondColumn .sBox").removeClass("active"),e(this).addClass("active"),v=e(this).attr("type")}).on("click",".columnManagament",function(){o(t,p)}).on("click",".selectAll",function(){r.getSel(x),m.getSelMedia()}).on("click",".clear",function(){r.getSelNot(x),m.getSelMedia()}).on("click",".mediaSearch",function(){var e=x.find('input[name="q"]').val();d(e,v,h)}).on("keydown",'input[name="q"]',function(e){13==e.keyCode&&(e.preventDefault(),x.find(".mediaSearch").trigger("click"))}).on("click",".meadiaAdd",function(){k.flag1=!1,i(t,p)}).on("click",".transCode",function(){var e=m.getSelMedia();if(e.length>1)return void alert("当前版本暂不支持批量转码！");c(e[0].id,e[0].type)}).on("click",".addToCloumn",function(){return s(x),!1}).on("click",".removeFromCloumn",function(){return u(x),!1}).on("click",".cloumnTwo",function(){e(".columnManagament").click()}).on("click",".mediaDelete",function(){k.flag2=!1,g()}).on("click",".thumbnail",function(){var n=e(this).parent(".mediaBigBox").attr("id"),a=e(this).parent(".mediaBigBox").find(".resourceTpye").text();l(n,a,t,p)}).on("click",".thumbnail input",function(n){n.stopPropagation(),m.getSelMedia(),1==e(this).prop("checked")?e(this).parents(".mediaBigBox").find(".coverBox").css("display","block"):e(this).parents(".mediaBigBox").find(".coverBox").css("display","none")});k.flag2=!0,k.flag2=!0,e(".kandao-contentBody").html(x),m.myAjax(M.json,f),m.getSelMedia(),e(".breadcrumb li").eq(0).on("click",function(){e(".home").trigger("click")})}var M=f(e(".kandao-mediaManagement"),8,k.flag1);e(".kandao-mediaManagement table tbody tr").length<=1&&!k.flag2&&(M.json.page=M.json.page-1||1),t.ajax({url:"medias/columns",type:"get",json:M.json},function(e){t.ajax({url:"medias",type:"get",json:M.json},function(n){if(!n.result.data.length)return M.json.page=M.json.page-1||1,void t.ajax({url:"medias",type:"get",json:M.json},function(n){h(e,n)});h(e,n)})})}});