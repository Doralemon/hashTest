define(["jquery","text!tpls/secretKeyManagementList.html","artTemplate","secretKeyManagement/search","common/amdApi","bootstrap","page"],function(t,e,a,n,i){return function(){var r=1;t(".kandao-secrentKey .pagination>li").each(function(e,a){t(a).hasClass("active")&&(console.log(e),r=t(a).children("a").attr("page"),r=parseInt(r))});var o={limit:10,page:r};i.ajax({url:"licenses",type:"get",json:o},function(s){var c=Math.ceil(s.result.count/10);s.result.index=c;var l=a.render(e,s.result),d=t(l).on("click",".secretKeySearch",function(){n()}).on("click",".btnIce",function(){var e=t(this).parents("tr").attr("id");e=parseInt(e);var a=t(this).parent().siblings(".key").text(),n=t(this).parent().siblings(".host").text(),r=t(this).parent().prev().attr("state");r=parseInt(r);var o={id:e,host:n,key:a,state:r};i.ajax({url:"licenses/"+e,type:"post",json:JSON.stringify(o)},function(e){t(".keyManagement").trigger("click")})}).on("keydown",'input[name="q"]',function(t){13==t.keyCode&&(t.preventDefault(),d.find(".secretKeySearch").trigger("click"))});t(".kandao-contentBody").html(d),t(".breadcrumb li").eq(0).on("click",function(){t(".home").trigger("click")});var h;h=c<6?c:6,1==c?t(".pagination").hide():t(".pagination").show(),function(e,a,n){t(".kandao-secrentKey").find(".pagination").jBootstrapPage({pageSize:e,total:n,pageNow:o.page,maxPageButton:a,onPageClicked:function(e,a){o.page=a+1,i.ajax({url:"licenses",type:"get",json:o},function(e){for(var a=" <thead><tr><th>公司</th><th>姓名</th><th>邮箱</th><th>密钥</th><th>主机</th><th>激活时间</th><th>状态</th><th>操作</th></tr></thead><tbody>",n=0;n<e.result.data.length;n++){var i=e.result.data[n];a+='<tr id="'+i.id+'"><td>'+i.company+"</td><td>"+i.name+"</td><td>"+i.email+'</td><td class="key">'+i.key+'</td><td class="host">'+i.host+"</td><td>"+i.active_time+'</td><td state="'+i.state+'">'+(0==i.state?"激活":"冻结")+'</td><td><button class="btn btnIce">'+(0==i.state?"冻结":"激活")+"</button></td></tr> "}a+="</tbody>",t(".kandao-secrentKey .secrentKeySearch table").html(a)})}})}(10,h,s.result.count),r>6&&(t(".pagination .goTo input").val(r),t(".go").click(),t(".pagination .goTo input").val(""))})}});