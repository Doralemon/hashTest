define(["jquery","text!tpls/secretKeyManagementSearch.html","artTemplate","common/amdApi","bootstrap","page"],function(t,e,a,n){return function(){var s=1;t(".kandao-secrentKey .pagination>li").each(function(e,a){t(a).hasClass("active")&&(s=t(a).attr("pnum"),s=parseInt(s))});var o=t('.kandao-secrentKey input[name="q"]').val(),r=t('.kandao-secrentKey select[name="type"]').val(),d=t('.kandao-secrentKey select[name="state"]').val(),i={limit:10,q:o,type:r,state:d,page:s};1==t(".kandao-secrentKey table tbody tr").length&&(obj.json.page=obj.json.page-1||1),n.ajax({url:"licenses",type:"get",json:i},function(o){var r=Math.ceil(o.result.count/10);o.result.index=r;var d=a.render(e,o.result),c=t(d);t(".kandao-secrentKey .secrentKeySearch").html(c);var l;l=r<6?r:6,1==r?t(".pagination").hide():t(".pagination").show(),function(e,a,s){t(".kandao-secrentKey").find(".pagination").jBootstrapPage({pageSize:e,total:s,maxPageButton:a,onPageClicked:function(e,a){i.page=a+1,n.ajax({url:"licenses",type:"get",json:i},function(e){for(var a=" <thead><tr><th>公司</th><th>姓名</th><th>邮箱</th><th>密钥</th><th>主机</th><th>激活时间</th><th>状态</th><th>操作</th></tr></thead><tbody>",n="",s="",o=0;o<e.result.data.length;o++){var r=e.result.data[o];0==r.state?(n="激活",s="冻结"):(n="冻结",s="激活"),a+='<tr id="'+r.id+'"><td>'+r.company+"</td><td>"+r.name+"</td><td>"+r.email+'</td><td class="key">'+r.key+'</td><td class="host">'+r.host+"</td><td>"+r.active_time+'</td><td state="'+r.state+'">'+n+'</td><td><button class="btn btnIce">'+s+"</button></td></tr> "}a+="</tbody>",t(".kandao-secrentKey .secrentKeySearch table").html(a)})}})}(10,l,o.result.count),t(".kandao-secrentKey .pagination>li").removeClass("active"),t(".kandao-secrentKey .pagination>li").eq(s).addClass("active")})}});