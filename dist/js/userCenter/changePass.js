define(["jquery","text!tpls/userBaseInfo.html","artTemplate","common/amdApi","bootstrap"],function(s,n,e,o){return function(){var a=e.render(n,{}),r=s(a).on("click",".btnChangePass",function(){s(".changePass").trigger("click")}).on("click",".btnBaseInfo",function(){s(".userBaseInfo").trigger("click")});s(".kandao-contentBody").html(r),s(".personCenterInfo .personNav").text("修改密码");s(".personCenterInfo").find(".panel-body").html('<div class="personInfo personPass"><form><div class="form-group"><label>旧密码</label><input type="text" class="form-control" placeholder="密码" name="old_password"><span class="passCorrate glyphicon glyphicon-ok-sign"></span><span class="passError glyphicon glyphicon-remove-sign">密码错误</span></div><div class="form-group"><label>新密码</label><input type="text" class="form-control" placeholder="新密码" name="new_password"><span class="newPass glyphicon glyphicon-ok-sign"></span><span class="passLenght glyphicon glyphicon-remove-sign">密码位数应该不低于8位且包含数字和字母</span></div><div class="form-group"><label>确认密码</label><input type="text" class="form-control" placeholder="确认密码" name="comfirm_password"><span class="confirmPass glyphicon glyphicon-ok-sign"></span><span class="withNew glyphicon glyphicon-remove-sign">必须与新密码一致</span></div><div class="form-group text-center"><button class="btn btn-default btnSave">确认</button><button class="btn btn-default btnCancel">取消</button></div></form></div>');var t,i,l,p=/^(?!(?:\d+|[a-zA-Z]+)$)[\da-zA-Z]{8,}$/;s('.personPass input[name="new_password"]').on("blur",function(){i=s(this).val(),p.test(i)?(s(".passLenght").hide(),s(".newPass").show()):(s(".newPass").hide(),s(".passLenght").show()),s('.personPass input[name="comfirm_password"]').trigger("blur")}),s('.personPass input[name="comfirm_password"]').on("blur",function(){l=s(this).val(),s.trim(i)?l!==i?(s(".confirmPass").hide(),s(".withNew").show()):(s(".withNew").hide(),s(".confirmPass").show()):(s(".withNew").hide(),s(".confirmPass").hide())}),s(".personCenterInfo .personPass").on("click",".btnSave",function(n){if(n.preventDefault(),t=s('.personPass input[name="old_password"]').val(),i=s('.personPass input[name="new_password"]').val(),l=s('.personPass input[name="comfirm_password"]').val(),!s.trim(t)||!s.trim(i)||!s.trim(l))return void alert("请输入完整信息！");if(l===i&&p.test(i)){var e={old_password:t,new_password:i,comfirm_password:l};s.ajax({url:o.getUrl()+"users/password_change",type:"post",data:JSON.stringify(e),success:function(n){if("10002"==n.code||"10003"==n.code||"10004"==n.code||"10005"==n.code)setTimeout(function(){location.href="login.html"},1500);else if("10107"==n.code)s(".passCorrate").hide(),s(".passError").show();else if(0==n.code)s(".passCorrate").show(),s(".passError").hide(),alert("密码修改成功！"),setTimeout(function(){location.href="login.html"},1500);else{switch(n.code){case 10109:alert("新密码与旧密码不能一样!");break;case 10108:alert("密码格式错误!")}s(".passError").hide(),s(".passCorrate").show()}}})}})}});