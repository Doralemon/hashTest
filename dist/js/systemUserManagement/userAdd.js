define(["jquery","text!tpls/systemBackend/systemUserAdd.html","artTemplate","common/amdApi","systemUserManagement/getData","bootstrap"],function(e,t,n,r,a){return function(){e("#systemUserAdd").remove();var a=[];r.ajax({url:"backend/permissions/roles/names",type:"get"},function(s){var i=n.render(t,s.result),o=e(i).on("click",".addRoles",function(t){t.preventDefault();var n=e("#systemUserAdd .roleManament select option:selected").attr("name");n=parseInt(n);var r=e("#systemUserAdd .roleManament select").val(),s=!0;if(a.forEach(function(e,t){return e==n&&(alert("此角色您已选择！"),s=!1),!1}),s){var i='<div class="roleBox text-center" roleId="'+n+'">'+r+'<span class="glyphicon glyphicon-remove-circle"></span></div>';o.find(".selectedRoles").append(i),a.push(n)}}).on("click",".glyphicon",function(){var t=e(this).parent().attr("roleId");t=parseInt(t),e(this).parent().hide(),a.forEach(function(e,n){return e==t&&a.splice(n,1),!1})}).on("click",".userAdd",function(t){t.preventDefault();var n=e('#systemUserAdd input[name="name"]').val(),s=e('#systemUserAdd input[name="email"]').val(),i=e('#systemUserAdd input[name="phone"]').val(),l=/^[0-9]*$/;if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(s))return void alert("您输入的电子邮箱格式不正确！");if(!l.test(i))return void alert("手机号必须为纯数字！");if(!(e.trim(n)&&e.trim(s)&&e.trim(i)&&a))return alert("请输入所有信息再提交！"),!1;var d={name:n,email:s,phone:i,has_roles:a};r.ajax({url:"backend/users/add",type:"post",json:JSON.stringify(d)},function(t){o.modal("hide"),e(".systemUserManagement").trigger("click")})}).appendTo("body").modal()})}});