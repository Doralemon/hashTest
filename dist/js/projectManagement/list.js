define(["jquery","text!tpls/projectManagementList.html","artTemplate","projectManagement/newAdd","projectManagement/edit","projectManagement/delete","projectManagement/search","common/amdApi","common/getPage","bootstrap","page"],function(t,n,e,a,o,i,r,c,d){return function(p){var l=d(t(".kandao-project"),10,p.flag1),g=l.json,u=l.page;1!=t(".kandao-project table tbody tr").length||p.flag2||(l.json.page=l.json.page-1||1),c.ajax({url:"productions/projects",type:"get",json:g},function(d){var l=Math.ceil(d.result.count/10);d.result.index=l;var s=e.render(n,d.result),f=t(s).on("click",".newAdd",function(){p.flag1=!1,a()}).on("click",".btn-edit",function(){var n=t(this).parent().attr("id");o(n)}).on("click",".btn-delete",function(){p.flag2=!1;var n=t(this).parent().attr("id");i(n)}).on("click",".projectserach",function(){t('.kandao-project input[name = "q"]').val();r()}).on("keydown",'input[name="q"]',function(t){13==t.keyCode&&(t.preventDefault(),f.find(".projectserach").trigger("click"))});p.flag1=!0,p.flag2=!0,t(".kandao-contentBody").html(f),t(".breadcrumb li").eq(0).on("click",function(){t(".home").trigger("click")});var j;j=l<6?l:6,1==l?t(".pagination").hide():t(".pagination").show(),u>6&&(t(".pagination .goTo input").val(g.page),t(".go").click(),t(".pagination .goTo input").val("")),function(n,e,a){f.find(".pagination").jBootstrapPage({pageSize:n,total:a,pageNow:g.page,maxPageButton:e,onPageClicked:function(n,e){g.page=e+1,c.ajax({url:"productions/projects",type:"get",json:g},function(n){for(var e="",a=0;a<n.result.data.length;a++){var o=n.result.data[a];e+='<tr id="'+o.id+'"><td>'+o.no+"</td><td>"+o.name+"</td><td>"+o.description+"</td><td>"+o.creator+"</td><td>"+o.date_created+'</td><td id="'+o.id+'"><button type="button" class="btn btn-edit btn-sm">编辑</button><button type="button" class="btn btn-delete btn-sm">删除</button></td></tr>'}t(".kandao-project table tbody").html(e)})}})}(10,j,d.result.count)})}});