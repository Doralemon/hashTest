define(["jquery","text!tpls/websiteManagement/kandaoNewsManagementAdd.html","artTemplate","common/amdApi","kindEditor","lang"],function(e,n,t,a){return function(i,d){e("#newsAdd").remove();var o,l,r,s={},m=t.render(n,d.result),c=e(m).on("change",".language  select",function(){o=e(this).val(),"ZH-CN"==o?(e("#newsAddFromCn").show(),e("#newsAddFromEn").hide()):(e("#newsAddFromCn").hide(),e("#newsAddFromEn").show())}).on("click",".btnAdd",function(n){function t(n,t,d){var l=e("#newsAdd "+n+' input[name = "title"]').val(),r=e("#newsAdd "+n+' select[name = "category_id"]').val(),m=e("#newsAdd "+n+' textarea[name = "abstract"]').val(),t=t;e("#newsAdd "+n+' textarea[name = "description"]').val();return s.title=l,s.abstract=m,s.category_id=r,s.context=t,s.language=o,e.trim(l)&&e.trim(t)&&e.trim(r+"")?e("#addMedia .thumbnail img").length>0&&-1==e("#addMedia #picID").val().indexOf(".jpg")?void alert("缩略图请使用后缀为.jpg的图片！"):void a.ajax({url:"official/kd_news/add",type:"post",json:JSON.stringify(s)},function(t){if(c.find(n+" .fileinput-exists img").length>0){i.flag=!1;var o=new FormData(c.find(d)[0]);e.ajax({url:a.getFileUrl()+"upload_action/",type:"post",data:o,cache:!1,contentType:!1,processData:!1,success:function(e){e.msg?console.log("upload success"):console.log(e.msg),i.flag=!0;var n={file_hash:e.file_hash,file_url:e.file_url,file_name:e.file_name,file_size:e.file_size,file_type:e.file_type,type:"news",pk:t.result.id};a.ajax({url:"medias/upload/thumbnail",type:"post",json:JSON.stringify(n)},function(e){})},error:function(e){i.flag=!0,console.log(e.msg)}})}i.flag=!0,setTimeout(function(){e(".kandaoNewsManagement").trigger("click")},500),c.modal("hide")}):void alert("新闻标题(title)/新闻内容(context)/新闻类型(News Style)是必填项！")}n.preventDefault(),o=e("#newsAdd .language select").val(),"ZH-CN"==o?(l=f[0].html(),t("#newsAddFromCn",l,"#newsAddImgCn")):(r=f[1].html(),t("#newsAddFromEn",r,"#newsAddImgEn"))}).appendTo("body").modal(),f=new Array;f[0]=KindEditor.create('#newsAddFromCn textarea[name="context"]',{filterMode:!1,allowFileManager:!0,resizeType:0,urlType:"domain",afterCreate:function(){}}),f[1]=KindEditor.create('#newsAddFromEn textarea[name="context"]',{filterMode:!1,allowFileManager:!0,resizeType:0,urlType:"domain",afterCreate:function(){}}),e("#newsAdd").off("shown.bs.modal").on("shown.bs.modal",function(n){e(document).off("focusin.modal")})}});